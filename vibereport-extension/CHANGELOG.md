# 변경 이력 (Changelog)

이 프로젝트의 모든 주요 변경사항을 기록합니다.

---

## [0.4.18] - 2025-12-19

### 🔒 보안 / 안정성

- **보고서 프리뷰 HTML 이스케이프 강화**: 인라인 코드/링크 라벨을 이스케이프하고, `href`에 따옴표/꺾쇠를 차단하여 XSS 위험을 낮춥니다.

### 🧪 품질/검증

- **Execution Checklist 헤더 파싱 유연화**: 이모지 유무 모두 지원하여 체크리스트 파싱 실패를 방지합니다.
- **확장 활성화/프리뷰 테스트 보강**: 비활성화 분기, 에디터 부재/비마크다운 문서 등 회귀 가능 경로를 추가 검증합니다.

### 📊 평가/히스토리

- **평가 히스토리 버전 라벨 개선**: 패키지 버전이 없을 때 `git:abcdef0@branch` 형식으로 표시하고 트렌드 표에서도 동일하게 출력합니다.

### 🚀 최적화

- **설정 저장 최적화**: 변경 없는 설정 키는 업데이트를 건너뛰어 불필요한 config write를 줄입니다.

### 🧪 CI/개발

- **CI pnpm 9 고정 + frozen-lockfile 설치**: lockfile v9와 정합성을 맞춰 설치 실패를 방지합니다.

---

## [0.4.17] - 2025-12-17

### ✨ 기능 추가

- **평가 트렌드(카테고리별) 기록/표시**: 평가 히스토리에 카테고리별 점수를 함께 저장하고, `AUTO-TREND` 블록에 총점 추세 표 + 카테고리별 추세 표를 함께 렌더링합니다.
- **Direct AI 모델 선택 기억**: 마지막으로 선택한 AI 모델 ID를 `globalState`에 저장하여 다음 실행 시 기본 선택으로 복원합니다.

### 🐛 버그 수정 / UX

- **UI 타임스탬프 포맷 통일**: 로케일 의존 `toLocaleString()` 대신 `formatTimestampForUi`를 사용해 `YYYY-MM-DD HH:mm` 형태로 일관 출력합니다.
- **Report Doctor에 Prompt.md 검증 추가**: Prompt.md의 한글 포함 여부, 체크리스트/프롬프트 섹션 매칭, 종료 섹션/메시지를 검증하고 결과에 포함합니다. (Repair는 Prompt.md 자동 생성/수정 제외)

### 🚀 최적화

- **마커 다중 교체 단일 패스 유틸**: 동일 문서에서 여러 구간 교체 시 라인 split/scan을 한 번만 수행하는 `replaceManyBetweenMarkersLines`를 추가하고, Session_History 통계/세션목록 갱신에 적용합니다.

### 🧪 품질/검증

- **마커 유틸 테스트 보강**: 다중 교체 결과가 기존 순차 교체와 동일함을 검증하고, 마커 누락 시 무변경을 보장합니다.

---

## [0.4.16] - 2025-12-17

### 🐛 버그 수정

- **개선 항목 적용 마킹 ID 추출 강화**: "적용 완료 마킹" 명령이 선택 영역에서 레포지토리 개선 ID 형식(`<kebab-case>-NNN`)을 안정적으로 추출합니다. (테이블 `**ID**`, `Linked Improvement ID:` 라인, 코드 스팬 폴백)
- **평가 히스토리 등급 산출 정합**: TL;DR 텍스트의 등급 토큰을 파싱하지 않고 `scoreToGrade(totalScore)`로 계산한 등급을 저장합니다.

### 🧪 품질/검증

- **문서 정합 테스트 추가**: `package.json` 버전과 CHANGELOG 최상단 버전 헤더 불일치 시 실패하는 테스트를 추가합니다.

---

## [0.4.15] - 2025-12-17

### 🧪 품질/CI

- **CI 작업 디렉토리 고정 및 캐시 개선**: GitHub Actions에서 `vibereport-extension` 하위에서 설치/빌드/테스트를 수행하고, pnpm 캐시 의존성 경로를 고정합니다.
- **정적 품질 게이트 추가**: CI에 `lint` 및 `test:coverage` 스텝을 추가합니다.

### 📦 패키징

- **패키지 산출물 제외 규칙 보강**: VS Code 확장 패키지에서 `coverage/`, `docs/`를 제외하도록 `.vscodeignore`를 보완합니다.

---

## [0.4.14] - 2025-12-16

### 🐛 버그 수정

- **Session History 동기화 정책 수정**: 보고서 업데이트 실행 시 `devplan/Session_History.md`를 매번 갱신하여 통계/세션 엔트리 드리프트를 방지합니다.
- **확장 활성화 로그 버전 정합**: 활성화 로그의 하드코딩 버전을 제거하고 `package.json` 버전을 기반으로 출력합니다.

### 🧪 품질/검증

- 워크플로우/스모크 테스트 보강 (상태 저장 → Session_History 갱신 순서, 활성화 로그 버전 출력)

---

## [0.4.13] - 2025-12-15

### 🚀 Major Update (v0.4.x Combined)
이 버전은 0.3.x에서 0.4.x로의 메이저 업데이트를 포함합니다.

#### 📦 로컬 Mermaid 번들링 및 오프라인 지원
- **Local Mermaid Integration**: 외부 CDN(jsdelivr) 의존성을 완전히 제거하고, 확장 프로그램 내부에 Mermaid.js 라이브러리를 번들링했습니다.
  - 오프라인 환경에서도 보고서 프리뷰가 완벽하게 동작합니다.
  - 프리뷰 로딩 속도가 획기적으로 개선되었습니다.

#### 🔒 보안 강화 (CSP)
- **Strict Content Security Policy**: Webview에 엄격한 CSP를 적용하여 외부 스크립트 실행을 원천 차단했습니다.
  - `script-src 'nonce-...'` 적용으로 보안성을 극대화했습니다.

#### 📊 보고서 시스템 고도화
- **기능 기반 패키지 구조도**: 평가 보고서에 Mermaid 기반의 아키텍처 다이어그램이 자동 생성됩니다.
- **상세 평가 지표**: 코드 품질, 아키텍처, 보안 등 10개 항목에 대한 정량적 점수와 등급(A~F)을 제공합니다.
- **개선 보고서 필터링**: 이미 적용된 프롬프트나 개선 항목은 자동으로 제외되어, "해야 할 일(Pending)"만 명확히 보여줍니다.

#### 🛠 기타 개선사항
- **Session History**: 세션별 스냅샷 관리가 더욱 안정화되었습니다.
- **Commands**: `Update Reports`, `Open Preview` 등 주요 명령어의 UX가 개선되었습니다.

---

## [0.3.26] - 2025-12-10

### 🧪 테스트 강화 (test-commands-001)

- **명령 계층 에러 테스트 추가**: `UpdateReportsCommand`와 `SetProjectVisionCommand`의 에러 시나리오 테스트 강화
  - 워크스페이스 스캔 실패 처리 테스트
  - 보고서 디렉토리 생성 실패 테스트  
  - 상태 저장 실패 테스트
  - 설정 업데이트 실패 테스트
- **에러 메시지 포맷터 추가**: `formatErrorMessage()` 헬퍼 함수로 일관된 `[VibeReport]` 접두사 형식 제공

### ⚡ 성능/관측성 개선 (opt-snapshot-diff-001)

- **스냅샷 Diff 라인 메트릭 추가**: `SnapshotDiff`에 `linesAdded`, `linesRemoved`, `linesTotal` 필드 추가
  - Git diff 정보에서 총 변경 라인 수 자동 계산
  - 변경 요약에 라인 메트릭 표시 (예: `+150 / -30 (총 180줄)`)
  - 고영향 세션을 빠르게 식별 가능

---

## [0.3.25] - 2025-12-09

### 🐛 버그 수정

- **OPT 항목 선택 기능 개선**: "개선 프롬프트 생성" 기능에서 Prompt.md의 OPT 항목이 선택되지 않던 문제 수정
  - OPT 섹션 헤더 감지 정규식을 더 유연하게 개선 (다양한 형식 지원)
  - `## 🔧 Optimization Items`, `## 🔧 OPT`, `## Optimization Items (OPT)` 등 다양한 헤더 형식 인식
  - OPT 섹션 헤더 없이 `### [OPT-XXX]`로 시작하는 경우에도 직접 OPT 항목 탐지
  - OPT 항목 내용 파싱 종료 조건 개선 (`## ✅ Final Completion` 등 추가 지원)

---

## [0.3.22] - 2025-12-07

### ✨ 개선사항

- **프리뷰 테마 완전 지원**: 배경색 설정 시 보고서 본문 영역의 배경색과 글씨색이 함께 변경
  - `white`: 흰색 배경 + 검은색 글씨
  - `black`: 검은색 배경 + 흰색 글씨
  - `ide`: IDE 테마 색상 사용 (기본값)
  - 테이블, 코드 블록, 인용구 등 모든 요소에 테마 적용

---

## [0.3.21] - 2025-12-07

### 🐛 버그 수정

- **프리뷰 배경색 설정 수정**: 설정에서 배경색 변경 시 실제로 적용되지 않던 문제 수정
  - `ide`, `white`, `black` 설정값을 실제 색상 코드로 변환하도록 수정

---

## [0.3.20] - 2025-12-07

### 🔧 개선사항

- **분석 프롬프트 템플릿 수정**: Autofix 적용 후 재빌드

---

## [0.3.19] - 2025-12-07

### 🔧 개선사항

- **분석 프롬프트 템플릿 모듈화**: `buildAnalysisPrompt` 함수를 별도 모듈(`analysisPromptTemplate.ts`)로 분리
  - `updateReports.ts`에서 약 830줄의 중복 코드 제거
  - 프롬프트 템플릿 유지보수성 향상
  - 코드 구조 개선 및 파일 크기 감소

---

## [0.3.18] - 2025-12-06

### 🔧 개선사항

- **분석 프롬프트 템플릿 전면 개편**: 보고서 업데이트 시 생성되는 AI 에이전트용 프롬프트 내용 개선
  - 더 명확한 TODO 체크리스트 및 실행 순서 지침
  - 파일 편집 규칙 및 청크 사이즈 가이드라인 강화
  - 평가 보고서, 개선 보고서, Prompt.md 각각의 작성 지침 상세화
  - 최종 검증 체크리스트 추가

---

## [0.3.14] - 2025-12-05

### 🐛 버그 수정

- **OPT 항목 선택 기능 안정화**: "개선 프롬프트 생성" 기능에서 OPT 항목이 가끔 선택되지 않던 문제 수정
  - 체크리스트 테이블 파싱을 라인별 처리로 개선하여 다양한 테이블 형식 지원
  - OPT 섹션 헤더 파싱 정규식 개선 (1~3자리 숫자 지원, 종료 조건 명확화)
  - 제목에서 백틱 ID 정리 (예: `` `opt-markdown-parse-001` ``)
  - 디버그 로깅 추가로 파싱 과정 추적 용이

---

## [0.3.13] - 2025-12-05

### 🔧 개선사항

- **Prompt.md 완료 항목 처리 강화**:
  - Execution Checklist에서 ✅/완료/DONE으로 표시된 항목을 자동으로 `appliedImprovements`로 인식
  - 보고서 업데이트 시 해당 항목을 개선 보고서와 Prompt.md에서 함께 제거하여 **완료된 프롬프트가 다시 생성되지 않도록** 개선
  - Prompt.md의 Execution Checklist 요약(`Total / Remaining`)이 남은 미완료 항목 수 기준으로 자동 갱신되도록 정리

---

## [0.3.12] - 2025-12-05

### ✨ 새로운 기능

- **적용 완료 항목 자동 제거**: 보고서 업데이트 시 개선 보고서와 Prompt.md에서 이미 적용된 항목을 자동으로 제거
  - ID 및 제목 기반 패턴 매칭으로 완료된 항목 식별
  - 더 이상 수동으로 완료 항목을 삭제할 필요 없음

- **프롬프트 선택에서 완료 항목 필터링**: "개선 프롬프트 생성" 메뉴에서 적용 완료된 항목은 더 이상 표시되지 않음
  - 미완료 항목만 선택 가능하여 혼란 방지

### 🔧 개선사항

- **TODO 체크리스트 언어 명시**: 분석 프롬프트 상단에 각 파일의 작성 언어 명시
  - 평가/개선 보고서: 한국어
  - Prompt.md: 영어 (ONLY)

- **Prompt.md 영어 작성 강제**: Prompt.md 파일은 반드시 영어로 작성하도록 지침 강화
  - "한글이 포함되면 파일이 무효" 경고 추가

- **OPT 항목 필수 포함**: 개선 보고서의 OPT 섹션이 Prompt.md에 반드시 포함되도록 지침 강화

- **Session_History.md 폴백 로직**: 마커가 없는 레거시 파일도 정상적으로 업데이트 가능

---

## [0.3.7] - 2025-12-04

### ✨ 새로운 기능

- **다중 프롬프트 선택 지원**: "개선 프롬프트 생성" 버튼 클릭 시 여러 개의 프롬프트/OPT 항목을 동시에 선택 가능
  - 체크박스로 여러 항목을 선택할 수 있음
  - 선택된 모든 항목이 구분선(`---`)으로 분리되어 클립보드에 복사됨
  - 한 번에 여러 개선 작업을 AI에게 요청할 때 유용

---

## [0.3.6] - 2025-12-04

### ✨ 새로운 기능

- **OPT 항목 선택 지원**: "개선 프롬프트 생성" 버튼 클릭 시 Prompt.md의 프롬프트뿐만 아니라 개선 보고서의 코드 품질/성능 최적화 제안(OPT) 항목도 함께 표시
  - OPT-1 (코드 최적화), OPT-2 (성능 튜닝) 등 최적화 항목 선택 가능
  - 선택 시 AI 에이전트용 프롬프트 형식으로 자동 포맷팅하여 클립보드에 복사
  - 프롬프트와 OPT 항목이 구분되어 표시됨

### 🔧 개선사항

- QuickPick UI에서 프롬프트와 OPT 항목을 구분하여 표시
- OPT 항목 선택 시 대상 파일 정보와 카테고리 표시

---

## [0.3.5] - 2025-12-04

### 🔧 개선사항

- **프롬프트 선택 기능 단순화**: "새 프롬프트 생성" 모드를 제거하고, Prompt.md에서 기존 프롬프트를 선택하여 복사하는 기능만 남김
  - 사용자 혼동 방지를 위한 UX 개선
  - 불필요한 코드 제거로 약 400줄 코드 감소

### 🐛 버그 수정

- 테스트 코드를 새로운 기능에 맞게 업데이트

---

## [0.3.4] - 2025-12-04

### ✨ 새로운 기능

- **기존 프롬프트 선택 및 복사 기능 개선**: Prompt.md에서 기존 프롬프트를 선택하여 클립보드에 바로 복사
  - 모드 선택: "기존 프롬프트 선택 및 복사" vs "새 프롬프트 생성"
  - 프롬프트 상태 표시 (⬜ 대기중, 🟡 진행중, ✅ 완료)
  - 다양한 Prompt.md 형식 지원

- **최적화 항목(OPT) 지원**: 코드 품질 및 성능 최적화 제안도 프롬프트 생성 시 선택 가능
  - P1/P2/P3 우선순위와 함께 OPT(최적화) 항목 추가
  - 개선 보고서의 최적화 섹션 파싱 지원

### 🔧 개선사항

- 프롬프트 파싱 정규식 개선으로 다양한 테이블 형식 지원
- 평가 보고서에 TL;DR, Risk Summary, Score-Mapping, Trend Analysis 섹션 추가
- 개선 보고서에 Error Exploration Procedure, Definition of Done 섹션 추가
- AGENTS.md에 Task Completion Rules (Section 7), Report Generation Rules (Section 8) 추가

### 🐛 버그 수정

- 기존 Prompt.md 파싱 시 체크리스트 테이블 형식 불일치 문제 수정
- OPT 우선순위 타입 누락으로 인한 컴파일 에러 수정

---

## [0.3.3] - 2025-06-02

### ✨ 새로운 기능

- **코드 품질/성능 최적화 분석 기능**: 개선 보고서와 Prompt.md 생성 시 code-optimization, performance-tuning 카테고리 지원
- **AUTO-OPTIMIZATION 마커**: 최적화 제안을 별도 섹션으로 관리

### 🔧 개선사항

- 테스트 84개로 확장
- 설정 로딩 중앙화 (configUtils)
- GeneratePromptCommand 단위 테스트 추가

---

## [0.3.1] - 2024-12-01

### ✨ 새로운 기능

- **명확한 점수-등급 기준 추가**: AI 에이전트가 일관된 평가를 수행할 수 있도록 정확한 점수-등급 매핑 기준 제공
  - A+: 97-100점, A: 93-96점, A-: 90-92점
  - B+: 87-89점, B: 83-86점, B-: 80-82점
  - C+: 77-79점, C: 73-76점, C-: 70-72점
  - D+: 67-69점, D: 63-66점, D-: 60-62점
  - F: 59점 이하

### 🔧 개선사항

- 분석 프롬프트에 점수-등급 변환 테이블 추가
- 등급별 이모지 시각화 (🟣 A등급, 🔵 B등급, 🟢 C등급, 🟡 D등급, ⚫ F등급)
- 평가 일관성 향상을 위한 명시적 등급 기준 제공

---

## [0.3.0] - 2024-12-01

### ✨ 새로운 기능

- **파트별 순차 작성 지침 강화**: AI 에이전트가 대용량 보고서 작성 시 출력 길이 제한에 걸리지 않도록 파트별 분리 작성 지침 추가
  - 한 번에 최대 150줄까지만 작성하도록 가이드
  - 파일별 파트 분리 순서 명시 (평가 보고서 4파트, 개선 보고서 3파트, 프롬프트 파일 3파트)
  - 올바른/잘못된 작성 예시 포함

### 🔧 개선사항

- 분석 프롬프트에 파트별 순차 작성 규칙 섹션 추가
- 프롬프트 파일(Prompt.md) 작성 시에도 파트 분리 지침 추가
- 완료 체크리스트에 파트별 순차 작성 확인 항목 추가

---

## [0.2.9] - 2024-12-01

### ✨ 새로운 기능

- **설정 UI에 프로젝트 비전 설정 추가**: 사이드바 Settings 패널에서 직접 프로젝트 비전 관련 설정을 변경할 수 있습니다.
  - 비전 모드 선택 (자동 분석 / 사용자 정의 비전)
  - 기본 프로젝트 유형 선택
  - 기본 개발 단계 선택
  - "상세 프로젝트 비전 설정" 버튼으로 Set Project Vision 명령 바로 실행

### 🔧 개선사항

- Settings 패널 UI 개선 및 프로젝트 비전 섹션 추가

---

## [0.2.8] - 2024-12-01

### ✨ 새로운 기능

- **프로젝트 비전 모드 설정 추가**: 확장 프로그램 설정에서 프로젝트 비전 모드를 선택할 수 있습니다.
  - `auto` (기본값): 파일 구조 기반 자동 분석 - 프로젝트 전체를 분석하여 모든 영역에서 개선점 제안
  - `custom`: 사용자 정의 비전 사용 - "Set Project Vision" 명령으로 설정한 비전 기반 맞춤 분석

- **기본 프로젝트 유형 설정**: `vibereport.defaultProjectType` 설정으로 프로젝트 유형 기본값 지정 가능
  - `auto-detect` (기본값): package.json 등을 분석하여 자동 감지
  - VS Code Extension, Web Frontend, Web Backend, Full Stack 등 다양한 유형 지원

- **기본 품질 우선순위 설정**: `vibereport.defaultQualityFocus` 설정으로 개발 단계 기본값 지정
  - `prototype`: 빠른 구현 우선
  - `development` (기본값): 기능 완성도 + 기본 품질
  - `stabilization`: 테스트, 에러 처리, 문서화 집중
  - `production`: 보안, 성능, 모니터링 집중
  - `maintenance`: 리팩토링, 기술 부채 해소

### 🔧 개선사항

- "Set Project Vision" 명령 실행 시 자동으로 `projectVisionMode`를 `custom`으로 변경
- 프로젝트 비전 설정 후 모드 변경 알림 표시

### 📝 설정 가이드

#### 기본 사용 (전체 파일 평가)

설정을 변경하지 않으면 기본값(`auto`)으로 프로젝트 전체를 분석합니다.

#### 맞춤 비전 사용

1. 명령 팔레트에서 "VibeCoding: Set Project Vision" 실행
2. 프로젝트 유형, 목표, 집중 영역 등 설정
3. 자동으로 `custom` 모드로 전환되어 설정한 비전 기반 분석

#### 설정에서 직접 변경

```json
{
  "vibereport.projectVisionMode": "auto",
  "vibereport.defaultProjectType": "vscode-extension",
  "vibereport.defaultQualityFocus": "development"
}
```

---

## [0.2.7] - 이전 버전

- 초기 릴리즈
- 프로젝트 평가 보고서 자동 생성
- 개선 제안 보고서 생성
- AI 프롬프트 파일 생성
- 세션 히스토리 관리
- 프로젝트 비전 설정 기능
